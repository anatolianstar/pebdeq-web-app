const fs = require('fs');
const path = require('path');

// Dosyalarƒ± ve import yollarƒ±nƒ± define et
const files = [
  { file: 'frontend/src/components/CategoryManagement.js', importPath: '../utils/config' },
  { file: 'frontend/src/components/GoogleSignIn.js', importPath: '../utils/config' },
  { file: 'frontend/src/components/Header.js', importPath: '../utils/config' },
  { file: 'frontend/src/components/ThemeBuilder.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/About.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/AdminDashboard.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/Checkout.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/Contact.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/EmailManagement.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/GeneralSettings.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/Login.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/Orders.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/PrivacyPolicy.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/Products.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/Register.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/ReturnPolicy.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/TermsOfService.js', importPath: '../utils/config' },
  { file: 'frontend/src/pages/UserDashboard.js', importPath: '../utils/config' },
  { file: 'frontend/src/themes/siteSettingsIntegration.js', importPath: '../utils/config' }
];

function addImportToFile(filePath, importPath) {
  try {
    let content = fs.readFileSync(filePath, 'utf8');
    
    // Zaten import var mƒ± kontrol et
    if (content.includes("createApiUrl")) {
      console.log(`‚ö° ${filePath} - import already exists`);
      return;
    }
    
    // createApiUrl kullanƒ±lƒ±yor mu kontrol et
    if (!content.includes("createApiUrl(")) {
      console.log(`‚ö° ${filePath} - createApiUrl not used, skipping`);
      return;
    }
    
    // React import'larƒ±ndan sonra ekle
    const lines = content.split('\n');
    let insertIndex = -1;
    
    // Son import'u bul
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].trim().startsWith('import ') && lines[i].includes('from ')) {
        insertIndex = i + 1;
      } else if (lines[i].trim() === '' && insertIndex > -1) {
        // ƒ∞lk bo≈ü satƒ±rda dur
        break;
      }
    }
    
    if (insertIndex === -1) {
      // Import bulunamadƒ±, dosyanƒ±n ba≈üƒ±na ekle
      insertIndex = 0;
    }
    
    // Import'u ekle
    const importStatement = `import { createApiUrl } from '${importPath}';`;
    lines.splice(insertIndex, 0, importStatement);
    
    // Dosyayƒ± yaz
    fs.writeFileSync(filePath, lines.join('\n'), 'utf8');
    console.log(`‚úÖ ${filePath} - import added`);
    
  } catch (error) {
    console.error(`‚ùå Error processing ${filePath}:`, error.message);
  }
}

// Ana i≈ülev
function main() {
  console.log('üîß Fixing missing createApiUrl imports...');
  
  files.forEach(({ file, importPath }) => {
    if (fs.existsSync(file)) {
      addImportToFile(file, importPath);
    } else {
      console.log(`‚ö†Ô∏è File not found: ${file}`);
    }
  });
  
  console.log('‚úÖ Import fixing completed!');
}

main(); 